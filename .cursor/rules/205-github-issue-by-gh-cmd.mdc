---
description: GitHub CLI를 사용하여 로컬 Markdown 파일로부터 GitHub Issue를 자동 생성하고 프로젝트에 등록하는 절차
globs: ["tasks/**/*.md"]
alwaysApply: false
---

# GitHub Issue 자동 생성 절차 (gh CLI)

## 개요
로컬 `tasks/` 디렉토리의 Markdown 파일을 GitHub Issue로 자동 생성하고, 프로젝트 로드맵에 일정을 등록하는 절차입니다.

## 파일 구조
마크다운 파일은 YAML frontmatter와 본문으로 구성됩니다:

```markdown
---
title: "[카테고리] 이슈 제목"
labels: ["label1", "label2"]
assignees: []
---

## 배경 (Context)
...
```

## 단계별 절차

### 1단계: 사전 확인
#### 1.1 저장소 정보 및 인증 확인
```powershell
gh repo view --json nameWithOwner,url
gh auth status
```

### 2단계: 중복 이슈 확인
```powershell
gh issue list --search "이슈제목" --json number,title
```

### 3단계: 마크다운 파일 파싱 및 준비
#### 3.1 Frontmatter 추출
- `title`: 이슈 제목
- `labels`: 라벨 배열 (필요 시 "Issue Automation" 추가)

#### 3.2 라벨 사전 생성 (필수)
GitHub CLI는 존재하지 않는 라벨을 지정하면 오류가 발생하므로, 사전에 생성해야 합니다.
```powershell
$labels = @("label1", "label2")
foreach ($label in $labels) {
    gh label create $label --color "1d76db" --force
}
```

#### 3.3 본문 임시 파일 생성
YAML frontmatter를 제외한 본문을 `issue-body-temp.md`에 저장합니다.

### 4단계: 이슈 생성
#### 4.1 기본 이슈 생성
```powershell
gh issue create `
  --title "[카테고리] 이슈 제목" `
  --body-file issue-body-temp.md `
  --label "label1,label2"
```

### 5단계: 프로젝트 등록 및 일정 설정
#### 5.1 프로젝트 정보 확인
```powershell
# 프로젝트 목록 및 번호 확인
gh project list --owner <소유자>

# 필드 ID 확인 (Start date, Target date)
gh project field-list <프로젝트번호> --owner <소유자> --format json
```

#### 5.2 프로젝트에 이슈 추가
```powershell
# 이슈 URL을 사용하여 프로젝트에 추가하고 Item ID 획득
$json = gh project item-add <프로젝트번호> --owner <소유자> --url <이슈URL> --format json
$itemId = ($json | ConvertFrom-Json).id
```

#### 5.3 일정(Start/Target Date) 설정
작업 선후 관계를 고려하여 날짜를 설정합니다.
- **Start Date**: 이전 작업 완료일 다음 날 (또는 오늘)
- **Target Date**: 작업 예상 기간을 더한 날짜

```powershell
# Start Date 업데이트
gh api graphql -f query='mutation($project:ID!,$item:ID!,$field:ID!,$value:Date!){updateProjectV2ItemFieldValue(input:{projectId:$project itemId:$item fieldId:$field value:{date:$value}}){projectV2Item{id}}}' `
  -f project=<ProjectNodeID> `
  -f item=<ItemID> `
  -f field=<StartFieldID> `
  -f value="YYYY-MM-DD"

# Target Date 업데이트 (동일한 방식 사용)
```

### 6단계: 정리
```powershell
Remove-Item issue-body-temp.md
```

## 주의사항
1. **라벨 존재 여부**: 이슈 생성 전 `gh label create`로 라벨을 반드시 확보하세요.
2. **PowerShell 문법**: 백틱(`)으로 줄바꿈, JSON 파싱 시 `ConvertFrom-Json` 사용.
3. **프로젝트 필드 ID**: 프로젝트마다 고유하므로 반드시 `gh project field-list`로 확인해야 합니다.
4. **날짜 형식**: `YYYY-MM-DD` 포맷을 엄격히 준수해야 합니다.
